<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update Rental</title>
</head>

<body>
    <h1>Update Rental</h1>
    <form action="/api/updateRental" id="update_form" method="POST"> 
        <input type="hidden" id="rentalID" name="rentalID"><br><br>
        
        <label for="vehicleid">Vehicle ID:</label> 
        <select id="vehicleid" name="vehicleid">
            <option value="">Select Vehicle</option>
        </select><br><br> 
        
        <label for="customerid">Customer ID:</label> 
        <select id="customerid" name="customerid">
            <option value="">Select Customer</option>
        </select><br><br> 
        
        <label for="startdate">Start Date:</label> 
        <input type="text" id="startdate" name="startdate" required><br><br> 
        
        <label for="enddate">End Date:</label> 
        <input type="text" id="enddate" name="enddate" required><br><br> 

        <label for="actualenddate">Actual End Date:</label> 
        <input type="text" id="actualenddate" name="actualenddate" required><br><br> 

        <label for="dailyrate">Daily Rate:</label> 
        <input type="text" id="dailyrate" name="dailyrate" required><br><br> 

        <label for="totalcost">Total Cost:</label> 
        <input type="text" id="totalcost" name="totalcost" required><br><br> 
        
        <input type="submit" value="Submit"> </form>
</body>

<script>

    
    (function() {
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);

        fetch('/api/get_vehicles')
            .then(response => response.json())
            .then(data => {
                const dropdown = document.querySelector('#vehicleid');
                dropdown.innerHTML = ''; // Clear previous entries
                data.rows.forEach(entry => {
                const newOption = document.createElement('option');
                newOption.value = entry.vehicleid;
                newOption.textContent = `${entry.licenseplate} - ${entry.make}`;
                dropdown.appendChild(newOption);

            });
        })
        .then(

        fetch('/api/get_customers')
            .then(response => response.json())
            .then(data => {
                const dropdown = document.querySelector('#customerid');
                dropdown.innerHTML = ''; // Clear previous entries
                data.rows.forEach(entry => {
                const newOption = document.createElement('option');
                newOption.value = entry.customerid;
                newOption.textContent = `${entry.lastname} (${entry.driverlicensenumber})`;
                dropdown.appendChild(newOption);

            });
        }))
        .then(

        
        fetch(`/api/get_rental?id=${urlParams.get('id')}`)
            .then(response => response.json())
            .then(data => {
                const vehicle_dl = document.querySelector('#vehicleid');
                const customer_dl = document.querySelector('#customerid');
        
                data.rows.forEach(entry => {
                        
                let RentalID = document.querySelector('#rentalID');
                RentalID.value = urlParams.get('id')
                
                const selected_vehicle = vehicle_dl.querySelector(`option[value="${entry.vehicleid}"]`);
                selected_vehicle.selected = true;

                const selected_customer = vehicle_dl.querySelector(`option[value="${entry.customerid}"]`);
                selected_customer.selected = true;

                let startDate = document.querySelector('#startdate');
                startDate.value = entry.startdate;

                let endDate = document.querySelector('#enddate');
                endDate.value = entry.enddate;

                let actualEndDate = document.querySelector('#actualenddate');
                actualEndDate.value = entry.actualenddate;

                let dailyRate = document.querySelector('#dailyrate');
                dailyRate.value = entry.dailyrate;

                let totalCost = document.querySelector('#totalcost');
                totalCost.value = entry.totalcost;

                });

    }));
})();

    
</script>

</html>
