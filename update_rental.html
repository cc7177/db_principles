<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update Rental</title>
</head>

<body>
    <h1>Update Rental</h1>
    <form action="/api/updateRecord/rentals" id="update_form" method="POST"> 
        <input type="hidden" id="primaryKeyColumn" name="primaryKeyColumn" value="rentalid"><br><br>
        <input type="hidden" id="primaryKeyValue" name="primaryKeyValue"><br><br>
        
        <label for="vehicleid">Vehicle ID:</label> 
        <select id="vehicleid" name="vehicleid">
            <option value="">Select Vehicle</option>
        </select><br><br> 
        
        <label for="customerid">Customer ID:</label> 
        <select id="customerid" name="customerid">
            <option value="">Select Customer</option>
        </select><br><br> 
        
        <label for="startdate">Start Date:</label> 
        <input type="text" id="startdate" name="startdate" required><br><br> 
        
        <label for="enddate">End Date:</label> 
        <input type="text" id="enddate" name="enddate" required><br><br> 

        <label for="actualenddate">Actual End Date:</label> 
        <input type="text" id="actualenddate" name="actualenddate" required><br><br> 

        <label for="package_id">Package ID:</label> 
        <select id="package_id" name="package_id">
            <option value="">Select Package</option>
        </select><br><br> 

        <label for="sales_associate">Sales Associate:</label> 
        <select id="sales_associate" name="sales_associate">
            <option value="">Select Associate</option>
        </select><br><br> 

        <label for="dailyrate">Daily Rate:</label> 
        <input type="text" id="dailyrate" name="dailyrate" required><br><br> 
        
        <input type="submit" value="Submit"> </form>
</body>

<script>

    
(function() {
  const queryString = window.location.search;
  const urlParams = new URLSearchParams(queryString);

  fetch('/api/getTable/vehicles')
    .then(response => response.json())
    .then(data => {
      const dropdown = document.querySelector('#vehicleid');
      dropdown.innerHTML = ''; // Clear previous entries

      data.rows.forEach(entry => {
        const newOption = document.createElement('option');
        newOption.value = entry.vehicleid;
        newOption.textContent = `${entry.licenseplate} - ${entry.make}`;
        dropdown.appendChild(newOption);
      });
    })
    .then(() => fetch('/api/getTable/customers'))
    .then(response => response.json())
    .then(data => {
      const dropdown = document.querySelector('#customerid');
      dropdown.innerHTML = ''; // Clear previous entries

      data.rows.forEach(entry => {
        const newOption = document.createElement('option');
        newOption.value = entry.customerid;
        newOption.textContent = `${entry.lastname} (${entry.driverlicensenumber})`;
        dropdown.appendChild(newOption);
      });
    })
    .then(() => fetch('/api/getTable/public.v_sales_associate'))
    .then(response => response.json())
    .then(data => {
      const dropdown = document.querySelector('#sales_associate');
      dropdown.innerHTML = ''; // Clear previous entries

      data.rows.forEach(entry => {
        const newOption = document.createElement('option');
        newOption.value = entry.employeeid;
        newOption.textContent = `${entry.employeeid} - ${entry.first_name} ${entry.last_name}`;
        dropdown.appendChild(newOption);
      });
    })
    .then(() => fetch('/api/getTable/packages'))
    .then(response => response.json())
    .then(data => {
      const dropdown = document.querySelector('#package_id');
      dropdown.innerHTML = ''; // Clear previous entries

      data.rows.forEach(entry => {
        const newOption = document.createElement('option');
        newOption.value = entry.packageid;
        newOption.textContent = `${entry.name})`;
        dropdown.appendChild(newOption);
      });
    })
    .then(() => fetch(`/api/getRecord/rentals?column=rentalid&value=${urlParams.get('id')}`))
    .then(response => response.json())
    .then(data => {
      const vehicle_dl = document.querySelector('#vehicleid');
      const customer_dl = document.querySelector('#customerid');
      const sales_assoc_dl = document.querySelector('#sales_associate');
      const packages_dl = document.querySelector('#package_id');

      data.rows.forEach(entry => {
        let RentalID = document.querySelector('#primaryKeyValue');
        RentalID.value = urlParams.get('id');

        const selected_vehicle = vehicle_dl.querySelector(`option[value="${entry.vehicleid}"]`);
        selected_vehicle.selected = true;

        const selected_customer = customer_dl.querySelector(`option[value="${entry.customerid}"]`);
        selected_customer.selected = true;

        const selected_sales_assoc = sales_assoc_dl.querySelector(`option[value="${entry.sales_associate}"]`);
        selected_sales_assoc.selected = true;

        const selected_package = packages_dl.querySelector(`option[value="${entry.package_id}"]`);
        selected_package.selected = true;

        let startDate = document.querySelector('#startdate');
        startDate.value = entry.startdate;

        let endDate = document.querySelector('#enddate');
        endDate.value = entry.enddate;

        let actualEndDate = document.querySelector('#actualenddate');
        actualEndDate.value = entry.actualenddate;

        let dailyRate = document.querySelector('#dailyrate');
        dailyRate.value = entry.dailyrate;

        let totalCost = document.querySelector('#totalcost');
        totalCost.value = entry.totalcost;
      });
    })
    .catch(error => {
      console.error('Error:', error);
    });
})();

    
</script>

</html>
